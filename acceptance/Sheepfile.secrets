# Local working directory
if File.basename(Dir.pwd)=='tmp'
  # Cucumber features
  working_directory File.expand_path('./')
  ssh_key=File.join('../', 'acceptance', 'id_rsa')
  gpg_private_key = File.join('../', 'acceptance', 'private_key.gpg')
else
  # Manual run
  working_directory File.expand_path("tmp")
  ssh_key='./acceptance/id_rsa'
  gpg_private_key = File.join('./acceptance', 'private_key.gpg')
end

encrypted_option=<<-EOF
hQEMA5gb42cxCFIzAQf/VhL1Cs9e1J6KD8uViUH76bRPYO73oS7I7c+M1+Wo6F/+oRDfOeifSJ2U5nHB
DuVMEJOR7Vqhhzxj5Neg+jrbOrmFtEtVV6y9xqzeHsB8liT2nc5Df1HAvHZ4ga+/SVzAK49/noAglriw
jmVodSae5hhxkTVJh2t6+Tpb1uwLepiZhbxczJ9zku7/KBp3tzPH9U9SCHVhiP5icl9p92ydVdi/lCfb
soklCPhZKlPK1Ck+FUrxzTX3RqG+7lEXu00SGQJncQhSqu/09cVO9h5qHfT3A3HqtmaxyslagrZGDFMq
3YQC4eeyTmFvj1kOBi1DKOkV3YKUHqKla9cyeSZymdJHAbvldJa2opaZxXJlKUQEuTU/2c+Era2WpQZr
RtAW7BP8kmpN1uFVzbTFossvXL9K7xtAFwjyhknANGk6jaK8YRMiEn7e3y0==qDcj
EOF

decrypt with: gpg_private_key

host "main-host", hostname: "127.0.0.1",
  ssh_port: 2222,
  working_directory: "/tmp/acceptance",
  private_key_data: encrypted("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=oWp9")

job "secret-credential" do
  resource "database", name: "control *db", host: "main-host"
  remotely as: "vagrant" do
    mysql_dump user: "operator", password: encrypted(encrypted_option)
  end
end
